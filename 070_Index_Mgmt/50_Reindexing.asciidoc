[[reindex]]
=== 重新索引你的数据 

尽管可以增加新的类型到索引中，或者增加新的字段到类型中，但是不能添加新的分析器或者对现有的字段做改动。
 ((("reindexing")))((("indexing", "reindexing your data"))) 如果你那么做的话，结果就是那些已经被索引的数据就不正确，
搜索也不能正常工作。

对现有数据的这类改变最简单的办法就是重新索引：用新的设置创建新的索引并把文档从旧的索引复制到新的索引。

字段 `_source` 的一个优点是在Elasticsearch中已经有整个文档。你不必从源数据中重建索引，而且那样通常比较慢。

为了有效的重新索引所有在旧的索引中的文档，用 <<scroll,_scroll_>> 从旧的索引检索批量文档 ((("using in reindexing documents"))) ，
然后用 <<bulk,`bulk` API>> 把文档推送到新的索引中。

从Elasticsearch v2.3.0开始， {ref}/docs-reindex.html[Reindex API] 被引入。它能够对文档重建索引而不需要任何插件或外部工具。

.批量重新索引
****

同时并行运行多个重建索引任务，但是你显然不希望结果有重叠。正确的做法是按日期或者时间
这样的字段作为过滤条件把大的重建索引分成小的任务：

[source,js]
--------------------------------------------------
GET /old_index/_search?scroll=1m
{
    "query": {
        "range": {
            "date": {
                "gte":  "2014-01-01",
                "lt":   "2014-02-01"
            }
        }
    },
    "sort": ["_doc"],
    "size":  1000
}
--------------------------------------------------


如果旧的索引会持续变化，你希望新的索引中也包括那些新加的文档。那就可以对新加的文档做重新索引，
但还是要用日期类字段过滤来匹配那些新加的文档。

****


